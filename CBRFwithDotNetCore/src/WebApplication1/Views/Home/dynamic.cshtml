@using CBRFConverter.Models
@{
}
<html>
<head>
    <title>Изменение курса валют по датам</title>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#periods').change(function () {
                if ($('#valute').val() == 00) return false;
                if ($('#periods').val() == 0) return false;
                var _per = $(periods).find('option:selected').val();
                var _vals = $(valute).find('option:selected').val();
                var target = $("#results");
                var getdates = [];
                var getcurses = [];
                target.empty();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("LoadCurses", "Select")",
                    data: {
                        "valName": _vals,
                        "period": _per
                    },
                    async: false,
                    success: function (data) {
                        var json = $.parseJSON(data);
                        target.append("<table border=\"1\" cellpadding=\"7\" cellspacing=\"0\">");
                        target.append("<tr><td align=\"center\"><ins><b>Дата</b></ins></td><td align=\"center\"><ins><b>Стоимость в рублях</b></ins></br></td></tr>");
                        for (var i = 0; i < json.length; ++i) {
                            target.append("<tr><td align=\"center\">" + json[i].day + "</td><td align=\"center\">"
                                + json[i].curse + "</td></tr>");
                            getdates.push(json[i].day);
                            getcurses.push(json[i].curse);
                        }
                        target.append("</table>");

                        google.charts.load('current', { 'packages': ['corechart'] });
                        google.charts.setOnLoadCallback(drawChart);
                        function drawChart() {
                            var datas = google.visualization.arrayToDataTable([
                              ['Дата', 'Стоимость'],
                              [getdates[0], parseFloat(getcurses[0])] //если изначально не добавить, то вообще не отрисуется график
                            ]);
                            for (var i = 1; i < getdates.length; ++i) {
                                datas.addRow([getdates[i], parseFloat(getcurses[i])]);
                            }
                            var options = {
                                title: _vals,
                                curveType: 'function',
                                legend: { position: 'bottom', textStyle: { color: '#ffffff' } },
                                subtitle: 'в рублях',
                                backgroundColor: '#1E223B',
                                titleTextStyle: {
                                    color: 'white'
                                },
                                vAxis:
                                {
                                    textStyle: {
                                        title: 'Даты',
                                        color: 'white'
                                    }
                                },
                                hAxis: {
                                    textStyle: {
                                        title: 'Стоимость',
                                        color: 'white'
                                    }
                                }
                            };
                            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                            chart.draw(datas, options);
                        }
                    },
                    dataType: 'html',
                    error: function (data) {
                        alert("Ошибка при запросе:" + data);
                    }
                });
            });
        });
    </script>


    <script type="text/javascript">
        $(document).ready(function () {
            $('#valute').change(function () {
                if ($('#valute').val() == 00) return false;
                if ($('#periods').val() == 0) return false;
                var _per = $(periods).find('option:selected').val();
                var _vals = $(valute).find('option:selected').val();
                var target = $("#results");
                var getdates = [];
                var getcurses = [];

                target.empty();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("LoadCurses", "Select")",
                    data: {
                        "valName": _vals,
                        "period": _per
                    },
                    async: false,
                    success: function (data) {
                        var json = $.parseJSON(data);
                        target.append("<table border=\"1\" cellpadding=\"7\" cellspacing=\"0\">");
                        target.append("<tr><td align=\"center\"><ins><b>Дата</b></ins></td><td align=\"center\"><ins><b>Стоимость в рублях</b></ins></br></td></tr>");
                        for (var i = 0; i < json.length; ++i) {
                            target.append("<tr><td align=\"center\">" + json[i].day + "</td><td align=\"center\">"
                                + json[i].curse + "</td></tr>");
                            getdates.push(json[i].day);
                            getcurses.push(json[i].curse);
                        }
                        target.append("</table>");
                        google.charts.load('current', { 'packages': ['corechart'] });
                        google.charts.setOnLoadCallback(drawChart);
                        function drawChart() {
                            var datas = google.visualization.arrayToDataTable([
                              ['Дата', 'Стоимость'],
                              [getdates[0], parseFloat(getcurses[0])] //если изначально не добавить, то вообще не отрисуется график
                            ]);
                            for (var i = 1; i < getdates.length; ++i) {
                                datas.addRow([getdates[i], parseFloat(getcurses[i])]);
                            }
                            var options = {
                                title: _vals,
                                curveType: 'function',
                                legend: { position: 'bottom', textStyle: { color: '#ffffff' } },
                                subtitle: 'в рублях',
                                backgroundColor: '#1E223B',
                                titleTextStyle: {
                                    color: 'white'
                                },
                                vAxis:
                                {
                                    textStyle: {
                                        title: 'Даты',
                                        color: 'white'
                                    }
                                },
                                hAxis: {
                                    textStyle: {
                                        title: 'Стоимость',
                                        color: 'white'
                                    }
                                }
                            };
                            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                            chart.draw(datas, options);
                        }
                    },
                    dataType: 'html',
                    error: function (data) {
                        alert("Ошибка при запросе:" + data);
                    }
                });
            });
        });
    </script>


    <style>
        .design {
            display: inline-block; /* Строчно-блочный элемент */
            padding: 5px 20px; /* Добавляем поля */
            text-decoration: none; /* Убираем подчёркивание у ссылки */
            cursor: pointer; /* Курсор в виде руки */
            border-radius: 10px; /* Скругляем уголки */
            border: 1px solid #008; /* Добавляем синюю рамку */
            font: 12px/1 Arial, sans-serif; /* Рубленый шрифт */
            color: #B6B8DB; /* Цвет текста и ссылки */
        }

        .selected {
            display: inline-block; /* Строчно-блочный элемент */
            padding: 5px 20px; /* Добавляем поля */
            text-decoration: none; /* Убираем подчёркивание у ссылки */
            cursor: pointer; /* Курсор в виде руки */
            border-radius: 10px; /* Скругляем уголки */
            border: 1px solid #008; /* Добавляем синюю рамку */
            font: 12px/1 Arial, sans-serif; /* Рубленый шрифт */
            color: #FBDA4D; /* Цвет текста и ссылки */
        }
    </style>
    <style>
        body {
            background: #1E223B;
            color: #ffffff;
        }

        hr {
            border: none;
            color: #292F4E;
            background-color: #292F4E;
            height: 1px;
        }
    </style>
</head>

<body>
    <center>
        <hr>
        <a href="/Home/Index/" class="design">Начальная страница</a>
        <a href="/Home/Dynamic/" class="selected">График</a>
        <a href="/Home/Convert/" class="design">Конвертер</a>
        <a href="/Home/Settings/" class="design">Настройки</a>
        <hr>
    </center>

    <h3>Изменение курса валют по датам</h3>

    <select id="valute" name="valSelection">
        <option value="00">---Выберите валюту---</option>
        @foreach (string val in (List<string>)ViewBag.SelectList)
        {
            <option>@val</option>
        }
    </select>

    <select id="periods" name="periodSelection">
        <option value="0">---Выберите период---</option>
        <option>Неделя</option>
        <option>Месяц</option>
        <option>Квартал</option>
        <option>Год</option>
    </select>

    @*Сюда выводятся даты с курсами*@
    <center>
        <div id="chart_div" style="width: 100%; height: 500px;"></div>
    </center>
    <center>
        <div id="results"></div>
    </center>
</body>
</html>